---
import { Icon } from "astro-icon/components";
import MenuItem from "./MenuItem.astro";
import MenuDropdown from "./MenuDropdown.astro";
import LanguageSwitcher from "./LanguageSwitcher.astro";

import { getLangFromUrl, useTranslations } from '../i18n';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<div class="flex flex-col bg-primary lg:flex-row lg:items-center min-h-full lg:min-h-0 w-full lg:w-max py-10 px-6 lg:px-0 lg:py-0 gap-6 lg:justify-center z-10">
  <div class="flex lg:hidden justify-between items-center w-full mb-6">
    <p class="font-bold text-2xl" data-i18n="siteTitle">CPES Paris-Saclay</p>
    <label for="mobile_drawer" class="hover:cursor-pointer">
      <Icon name="ri:close-line" class="text-3xl" />
    </label>
  </div>

  <MenuItem href="/">{t('home')}</MenuItem>

  <MenuDropdown title={t('formation')}>
    <MenuItem href="/a-propos"> {t('apropos')}</MenuItem>
    <MenuItem href="/formation/lycee-international-de-palaiseau"> {t('lipps')}</MenuItem>
    <MenuItem href="/formation/institut-polytechnique-de-paris"> {t('ipp')}</MenuItem>
    <MenuItem href="/formation/universite-paris-saclay"> {t('ups')}</MenuItem>
    <MenuItem href="/formation/hec-paris"> {t('hec')}</MenuItem>
    <MenuItem href="/formation/ens-paris-saclay"> {t('ens')}</MenuItem>
  </MenuDropdown>

  <MenuDropdown title={t('informations')}>
    <MenuItem href="/programme"> {t('programme')}</MenuItem>
    <MenuItem href="/debouches"> {t('debouches')}</MenuItem>
    <MenuItem href="/boursiers"> {t('boursiers')}</MenuItem>
    <MenuItem href="/faq"> {t('faq')}</MenuItem>
    <MenuItem href="/documents-officiels"> {t('documentsOfficiels')}</MenuItem>
  </MenuDropdown>

  <MenuDropdown title={t('ouvertures')}>
    <MenuItem href="/langues-sports-ateliers"> {t('languesSportsAteliers')}</MenuItem>
    <MenuItem href="/conferences"> {t('conferences')}</MenuItem>
    <MenuItem href="/visites"> {t('visites')}</MenuItem>
    <MenuItem href="/projets-et-entrepreneuriat"> {t('projets')}</MenuItem>
    <MenuItem href="/initiation-a-la-recherche"> {t('recherches')}</MenuItem>
    <MenuItem href="/capstone"> {t('capstone')}</MenuItem>
  </MenuDropdown>

  <MenuDropdown title={t('vieEtAdmissions')}>
    <MenuItem href="/nos-etudiants"> {t('etudiants')}</MenuItem>
    <MenuItem href="/partenaires"> {t('partenaires')}</MenuItem>
    <MenuItem href="/admission"> {t('admissions')}</MenuItem>
    <MenuItem href="/contact"> {t('contact')}</MenuItem>
  </MenuDropdown>

  <LanguageSwitcher />

  <div class="theme-toggle-btn flex items-center gap-2 text-2xl hover:cursor-pointer mx-auto z-50 lg:mx-0">
    <Icon name="ri:sun-fill" class="theme-icon-light" />
    <Icon name="ri:moon-line" class="theme-icon-dark hidden" />
    <span class="lg:hidden text-base" data-i18n="mode">Mode</span>
  </div>
</div>

<script is:inline>
  (function () {
    function updateThemeIcon() {
      const currentTheme =
        document.documentElement.getAttribute("data-theme") ||
        localStorage.getItem("theme") ||
        "cpes-paris-saclay-light";

      const lightIcons = document.querySelectorAll(".theme-icon-light");
      const darkIcons = document.querySelectorAll(".theme-icon-dark");

      if (currentTheme === "cpes-paris-saclay-dark") {
        lightIcons.forEach(function (icon) {
          icon.classList.add("hidden");
        });
        darkIcons.forEach(function (icon) {
          icon.classList.remove("hidden");
        });
      } else {
        lightIcons.forEach(function (icon) {
          icon.classList.remove("hidden");
        });
        darkIcons.forEach(function (icon) {
          icon.classList.add("hidden");
        });
      }
    }

    var savedTheme = localStorage.getItem("theme");
    if (savedTheme) {
      document.documentElement.setAttribute("data-theme", savedTheme);
    }

    updateThemeIcon();
    function attachListeners() {
      var toggleButtons = document.querySelectorAll(".theme-toggle-btn");
      toggleButtons.forEach(function (button) {
        if (button.dataset.themeListenerAttached) return;
        button.dataset.themeListenerAttached = "true";
        button.addEventListener("click", function () {
          var currentTheme =
            document.documentElement.getAttribute("data-theme") ||
            "cpes-paris-saclay-light";
          var newTheme =
            currentTheme === "cpes-paris-saclay-dark"
              ? "cpes-paris-saclay-light"
              : "cpes-paris-saclay-dark";

          document.documentElement.setAttribute("data-theme", newTheme);
          localStorage.setItem("theme", newTheme);
          updateThemeIcon();
        });
      });
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", attachListeners);
    } else {
      attachListeners();
    }
  })();
</script>
